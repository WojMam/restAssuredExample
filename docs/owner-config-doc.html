<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Konfiguracja testÃ³w z uÅ¼yciem biblioteki OWNER</title>
    <style>
        body { font-family: sans-serif; line-height: 1.6; padding: 2em; }
        h1, h2, h3 { color: #2c3e50; }
        code, pre { background: #f4f4f4; padding: 0.5em; display: block; overflow-x: auto; border-radius: 4px; }
        table { border-collapse: collapse; width: 100%; margin: 1em 0; }
        th, td { border: 1px solid #ccc; padding: 8px; }
        th { background: #eee; }
    </style>
</head>
<body>
<h1>ğŸ§ª Konfiguracja testÃ³w z uÅ¼yciem biblioteki OWNER</h1>
<p><strong>Dokumentacja dla projektÃ³w korzystajÄ…cych ze wspÃ³lnego mechanizmu konfiguracji (core + podprojekty)</strong></p>

<h2>ğŸ“š Cel</h2>
<p>WspÃ³lna konfiguracja testÃ³w automatycznych oparta na bibliotece OWNER, pozwalajÄ…ca:</p>
<ul>
<li>zarzÄ…dzaÄ‡ zmiennymi konfiguracyjnymi centralnie i per-projektowo,</li>
<li>rozdzieliÄ‡ konfiguracjÄ™ wspÃ³lnÄ… i Å›rodowiskowÄ…,</li>
<li>Å‚adowaÄ‡ rÃ³Å¼ne konfiguracje w zaleÅ¼noÅ›ci od Å›rodowiska (dev, uat, prod),</li>
<li>korzystaÄ‡ z jednego wspÃ³lnego mechanizmu Å‚adowania w core.</li>
</ul>

<h2>ğŸ“¦ Struktura projektu</h2>
<pre><code>root/
â”œâ”€â”€ core/
â”‚   â””â”€â”€ src/main/java/com/example/core/config/
â”‚       â”œâ”€â”€ OwnerSupport.java
â”‚       â””â”€â”€ GenericConfigManager.java
â”œâ”€â”€ projekt-e/
â”‚   â”œâ”€â”€ src/test/java/com/example/projekte/config/
â”‚   â”‚   â”œâ”€â”€ TestConfig.java
â”‚   â”‚   â””â”€â”€ TestConfigManager.java
â”‚   â””â”€â”€ src/test/resources/
â”‚       â”œâ”€â”€ config-common.properties
â”‚       â””â”€â”€ config-uat.properties
â”œâ”€â”€ projekt-p/
â”‚   â””â”€â”€ ...
</code></pre>

<h2>ğŸ”§ Co tworzymy?</h2>
<table>
<tr><th>Element</th><th>Gdzie?</th><th>Opis</th></tr>
<tr><td>GenericConfigManager</td><td>core</td><td>WspÃ³lna klasa do Å‚adowania konfiguracji (bez env)</td></tr>
<tr><td>OwnerSupport</td><td>core</td><td>Wrapper wokÃ³Å‚ ConfigFactory</td></tr>
<tr><td>TestConfig</td><td>projekt</td><td>Interfejs z kluczami konfiguracyjnymi</td></tr>
<tr><td>TestConfigManager</td><td>projekt</td><td>Lokalna klasa dostÄ™pu do configu + ustawienie env</td></tr>
</table>

<h2>ğŸ“ core/config/GenericConfigManager.java</h2>
<pre><code>package com.example.core.config;

import org.aeonbits.owner.Config;

public class GenericConfigManager {
    public static &lt;T extends Config&gt; T load(Class&lt;T&gt; configClass) {
        return OwnerSupport.load(configClass);
    }
}
</code></pre>

<h2>ğŸ“ core/config/OwnerSupport.java</h2>
<pre><code>package com.example.core.config;

import org.aeonbits.owner.ConfigFactory;
import org.aeonbits.owner.Config;

public class OwnerSupport {
    public static &lt;T extends Config&gt; T load(Class&lt;T&gt; configClass) {
        return ConfigFactory.create(configClass);
    }
}
</code></pre>

<h2>ğŸ“ projekt-e/config/TestConfig.java</h2>
<pre><code>package com.example.projekte.config;

import org.aeonbits.owner.Config;
import org.aeonbits.owner.Config.Sources;
import org.aeonbits.owner.LoadPolicy;
import org.aeonbits.owner.LoadType;
import org.aeonbits.owner.Config.Key;

@LoadPolicy(LoadType.MERGE)
@Sources({
    "classpath:config-common.properties",
    "classpath:config-${env}.properties"
})
public interface TestConfig extends Config {

    @Key("base.url")
    String baseUrl();

    @Key("auth.token")
    String authToken();

    @Key("timeout.ms")
    int timeoutMs();
}
</code></pre>

<h2>ğŸ“ projekt-e/config/TestConfigManager.java</h2>
<pre><code>package com.example.projekte.config;

import com.example.core.config.GenericConfigManager;

public class TestConfigManager {

    static {
        if (System.getProperty("env") == null) {
            System.setProperty("env", "dev");
        }
    }

    private static final TestConfig CONFIG = GenericConfigManager.load(TestConfig.class);

    public static TestConfig get() {
        return CONFIG;
    }
}
</code></pre>

<h2>ğŸ“ Pliki .properties</h2>
<h3>ğŸ”¹ config-common.properties</h3>
<pre><code>timeout.ms=3000
feature.flag=true
</code></pre>
<h3>ğŸ”¹ config-uat.properties</h3>
<pre><code>base.url=https://uat.api.example.com
auth.token=xyz-uat-token
</code></pre>

<h2>ğŸš€ UÅ¼ycie w testach</h2>
<pre><code>import com.example.projekte.config.TestConfigManager;
import static io.restassured.RestAssured.*;
import org.junit.jupiter.api.Test;

public class SampleApiTest {

    @Test
    void shouldCallHealthCheck() {
        String url = TestConfigManager.get().baseUrl();
        int timeout = TestConfigManager.get().timeoutMs();

        given()
            .baseUri(url)
            .when()
            .get("/health")
            .then()
            .statusCode(200);
    }
}
</code></pre>

<h2>ğŸ” Zmiana Å›rodowiska</h2>
<h3>ğŸ”¹ W kodzie (lokalne testy):</h3>
<pre><code>System.setProperty("env", "uat");</code></pre>
<h3>ğŸ”¹ W parametrach JVM (np. w IntelliJ, Maven, CI):</h3>
<pre><code>-Denv=uat</code></pre>

<h2>âœ… Dobre praktyki</h2>
<ul>
<li>Nigdy nie ustawiaj <code>env</code> w core â€“ zostaw to logice projektowej.</li>
<li>Dodaj <code>@LoadPolicy(LoadType.MERGE)</code> do interfejsu OWNER, inaczej tylko pierwszy plik zostanie uÅ¼yty.</li>
<li>Nie powielaj kluczy w plikach common i config-${env} â€“ Å›rodowiskowy powinien tylko nadpisywaÄ‡.</li>
<li>Umieszczaj pliki .properties w <code>src/test/resources</code>.</li>
</ul>

<h2>ğŸ§ª Diagnostyka bÅ‚Ä™dÃ³w</h2>
<table>
<tr><th>Problem</th><th>Diagnoza</th></tr>
<tr><td>null zamiast wartoÅ›ci</td><td>Klucz nie istnieje w interfejsie lub <code>env</code> nie jest ustawiony</td></tr>
<tr><td>common nie Å‚aduje siÄ™</td><td>Brak <code>@LoadPolicy(LoadType.MERGE)</code></td></tr>
<tr><td>${env} nie dziaÅ‚a</td><td>Nie ustawiono <code>System.setProperty("env", "...")</code></td></tr>
</table>

<h2>ğŸ§­ Podsumowanie</h2>
<table>
<tr><th>Klasa</th><th>Rola</th></tr>
<tr><td>GenericConfigManager</td><td>Neutralny loader z core, nieustawiajÄ…cy env</td></tr>
<tr><td>TestConfig</td><td>Interfejs z definicjÄ… kluczy</td></tr>
<tr><td>TestConfigManager</td><td>Adapter z env i get()</td></tr>
<tr><td>.properties</td><td>W resources, dzielone na common i Å›rodowiskowe</td></tr>
</table>

</body>
</html>